<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polygenic Risk Scores - Interactive Guide</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600&family=IBM+Plex+Mono&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --secondary: #059669;
            --accent: #dc2626;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }
        
        body {
            font-family: 'IBM Plex Sans', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        header {
            text-align: center;
            padding: 3rem 0;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            margin-bottom: 2rem;
        }
        
        header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }
        
        .card h2 {
            color: var(--primary);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card h3 {
            font-size: 1.1rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--text);
        }
        
        .highlight-box {
            background: #eff6ff;
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .formula {
            font-family: 'IBM Plex Mono', monospace;
            background: #f1f5f9;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2rem;
            margin: 1rem 0;
        }
        
        /* Interactive PRS Calculator */
        .calculator {
            display: grid;
            gap: 1.5rem;
        }
        
        .snp-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .snp-table th {
            background: #f1f5f9;
            padding: 0.75rem;
            text-align: left;
            font-weight: 500;
            border-bottom: 2px solid var(--border);
        }
        
        .snp-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }
        
        .snp-table select {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: inherit;
            cursor: pointer;
        }
        
        .result-box {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }
        
        .result-box .score {
            font-size: 2.5rem;
            font-weight: 600;
        }
        
        .result-box .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1.5rem 0;
        }
        
        /* Distribution Demo */
        .slider-group {
            margin: 1rem 0;
        }
        
        .slider-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .slider-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
            cursor: pointer;
        }
        
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .percentile-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .percentile-card {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .percentile-card.low {
            background: #dcfce7;
            color: #166534;
        }
        
        .percentile-card.avg {
            background: #fef3c7;
            color: #92400e;
        }
        
        .percentile-card.high {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .percentile-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        /* Clinical Applications Grid */
        .clinical-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .clinical-item {
            background: #f8fafc;
            padding: 1.25rem;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .clinical-item h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .clinical-item ul {
            font-size: 0.9rem;
            color: var(--text-muted);
            padding-left: 1.2rem;
        }
        
        .clinical-item li {
            margin: 0.3rem 0;
        }
        
        /* Limitations */
        .limitation-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .limitation-item:last-child {
            border-bottom: none;
        }
        
        .limitation-icon {
            width: 40px;
            height: 40px;
            background: #fee2e2;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        /* Step indicators */
        .steps {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
            position: relative;
        }
        
        .steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 40px;
            right: 40px;
            height: 3px;
            background: var(--border);
        }
        
        .step {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: 600;
        }
        
        .step-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Tasks Section Styles */
        .task-section {
            background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .task-section h2 {
            color: white;
        }

        .task-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
            color: var(--text);
        }

        .task-card h3 {
            color: var(--primary);
            margin-top: 0;
        }

        .task-card ol, .task-card ul {
            padding-left: 1.5rem;
        }

        .task-card li {
            margin: 0.5rem 0;
        }

        .discussion-question {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            margin: 0.75rem 0;
            border-left: 3px solid var(--primary);
        }

        .discussion-question strong {
            color: var(--primary);
        }

        /* Multiple Choice Styles */
        .mc-question {
            background: #f8fafc;
            padding: 1.25rem;
            border-radius: 10px;
            margin: 1rem 0;
            border: 1px solid var(--border);
        }

        .mc-question h4 {
            margin: 0 0 1rem 0;
            color: var(--text);
        }

        .mc-options {
            list-style: none;
            padding: 0;
        }

        .mc-options li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .mc-options li::before {
            content: attr(data-letter) ")";
            position: absolute;
            left: 0;
            font-weight: 500;
            color: var(--primary);
        }

        /* References */
        .references {
            font-size: 0.9rem;
        }

        .references ul {
            list-style: none;
            padding: 0;
        }

        .references li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .references li:last-child {
            border-bottom: none;
        }

        /* Learning Objectives */
        .learning-objectives {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: 10px;
            padding: 1.25rem;
            margin: 1rem 0;
            color: #1e293b;
        }

        .learning-objectives h4 {
            color: #047857;
            margin: 0 0 0.75rem 0;
        }

        .learning-objectives ul {
            margin: 0;
            padding-left: 1.5rem;
            color: #1e293b;
        }

        .learning-objectives li {
            margin: 0.3rem 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>üß¨ Polygenic Risk Scores</h1>
        <p>An Interactive Introduction for Molecular Medicine Students</p>
    </header>
    
    <div class="container">
        <!-- What is PRS -->
        <div class="card">
            <h2>üìñ What is a Polygenic Risk Score?</h2>
            <p>
                Most common diseases are <strong>polygenic</strong>‚Äîinfluenced by hundreds or thousands of genetic variants, 
                each with a small effect. A <strong>Polygenic Risk Score (PRS)</strong> combines all these small effects 
                into a single number representing your overall genetic predisposition.
            </p>
            <div class="highlight-box">
                <strong>üí° Key Insight:</strong> While a single variant might increase disease risk by just 1-5%, 
                the combined effect of many variants can identify individuals with substantially elevated risk.
            </div>
        </div>
        
        <!-- GWAS Introduction -->
        <div class="card">
            <h2>üî¨ Genome-Wide Association Studies (GWAS)</h2>
            <p>
                Before we can build a PRS, we need to know which genetic variants are associated with a disease
                and how strong each association is. This is where <strong>Genome-Wide Association Studies (GWAS)</strong> come in.
            </p>

            <h3>What is a GWAS?</h3>
            <p>
                A GWAS is a <strong>case-control study</strong> that scans the entire genome to find genetic variants
                (SNPs) associated with a disease. Researchers compare the frequency of millions of SNPs between:
            </p>
            <ul style="padding-left: 1.5rem; margin: 1rem 0;">
                <li><strong>Cases:</strong> People with the disease (e.g., 50,000 patients with Type 2 Diabetes)</li>
                <li><strong>Controls:</strong> People without the disease (e.g., 50,000 healthy individuals)</li>
            </ul>

            <!-- GWAS Diagram -->
            <div style="background: #f8fafc; border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0;">
                <div style="text-align: center; font-weight: 500; margin-bottom: 1rem;">Case-Control Comparison for SNP rs12345 (Allele A vs G)</div>
                <div style="display: flex; justify-content: center; gap: 3rem; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <div style="font-weight: 600; color: #dc2626; margin-bottom: 0.5rem;">Cases (Diabetes)</div>
                        <div style="display: flex; gap: 4px; justify-content: center; flex-wrap: wrap; max-width: 120px;">
                            <span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 14px;"><strong>60%</strong> carry allele A</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-weight: 600; color: #2563eb; margin-bottom: 0.5rem;">Controls (Healthy)</div>
                        <div style="display: flex; gap: 4px; justify-content: center; flex-wrap: wrap; max-width: 120px;">
                            <span style="background: #2563eb; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #2563eb; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #2563eb; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #2563eb; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">A</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                            <span style="background: #94a3b8; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">G</span>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 14px;"><strong>40%</strong> carry allele A</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                    <span style="color: #059669; font-weight: 500;">‚Üí Allele A is more frequent in cases ‚Üí associated with disease</span>
                </div>
            </div>

            <h3>The Odds Ratio: Measuring Effect Size</h3>
            <p>
                For each SNP, GWAS calculates an <strong>odds ratio (OR)</strong>. Since GWAS is a retrospective
                case-control study, the odds ratio tells us:
            </p>
            <div class="highlight-box">
                <strong>Interpretation:</strong> The odds of carrying the risk allele are OR times higher in cases
                compared to controls.
            </div>
            <p>
                For example, if OR = 1.15 for allele A at a particular SNP:
            </p>
            <ul style="padding-left: 1.5rem; margin: 1rem 0;">
                <li>The odds of carrying allele A are <strong>15% higher</strong> in people with the disease</li>
                <li>Under the rare disease assumption, this approximates: "carriers of allele A have 15% higher odds of developing the disease"</li>
            </ul>
            <p>
                The effect size <strong>Œ≤ (beta)</strong> used in PRS calculations is the natural log of the odds ratio: <strong>Œ≤ = ln(OR)</strong>
            </p>

            <h3>Why Test Millions of SNPs?</h3>
            <p>
                Common diseases are influenced by many variants, each with a small effect. A typical GWAS tests
                <strong>5-10 million SNPs</strong> and may identify hundreds of associated variants. Because we test
                so many SNPs, we need very large sample sizes (often 100,000+ people) to reliably detect these small effects
                while accounting for multiple testing.
            </p>
        </div>

        <!-- How PRS are Built -->
        <div class="card">
            <h2>üßÆ From GWAS to PRS</h2>

            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-label">GWAS</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-label">Extract Effects</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-label">Weight √ó Genotype</div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-label">Sum Scores</div>
                </div>
            </div>

            <h3>Building the Score</h3>
            <p>
                Once GWAS identifies associated variants and their effect sizes, we can calculate a PRS for any individual:
            </p>
            <div class="formula">
                PRS = Œ£ (Œ≤<sub>i</sub> √ó G<sub>i</sub>)
            </div>
            <p>Where:</p>
            <ul style="padding-left: 1.5rem; margin: 1rem 0;">
                <li><strong>Œ≤<sub>i</sub></strong> = effect size (log odds ratio) for SNP i from the GWAS</li>
                <li><strong>G<sub>i</sub></strong> = number of risk alleles the person carries at SNP i (0, 1, or 2)</li>
                <li><strong>Œ£</strong> = sum across all SNPs included in the score</li>
            </ul>
            <p>
                The result is a single number summarizing an individual's genetic predisposition. Higher scores
                indicate higher genetic risk.
            </p>
        </div>
        
        <!-- Interactive Calculator & Distribution Side by Side -->
        <div class="card">
            <h2>üßÆ Interactive PRS Calculator</h2>
            <p>Try changing genotypes to see how PRS changes and watch the red marker move on the distribution chart!</p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: start;">
                <!-- Left: Calculator -->
                <div>
                    <table class="snp-table">
                        <thead>
                            <tr>
                                <th>SNP</th>
                                <th>Risk Allele</th>
                                <th>Œ≤</th>
                                <th>Genotype</th>
                                <th>Contrib.</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>rs12345</td>
                                <td>A</td>
                                <td>0.15</td>
                                <td>
                                    <select id="snp1" onchange="calculatePRS()">
                                        <option value="0">GG (0)</option>
                                        <option value="1" selected>AG (1)</option>
                                        <option value="2">AA (2)</option>
                                    </select>
                                </td>
                                <td id="contrib1">0.15</td>
                            </tr>
                            <tr>
                                <td>rs67890</td>
                                <td>T</td>
                                <td>0.08</td>
                                <td>
                                    <select id="snp2" onchange="calculatePRS()">
                                        <option value="0">CC (0)</option>
                                        <option value="1">CT (1)</option>
                                        <option value="2" selected>TT (2)</option>
                                    </select>
                                </td>
                                <td id="contrib2">0.16</td>
                            </tr>
                            <tr>
                                <td>rs11223</td>
                                <td>G</td>
                                <td>0.12</td>
                                <td>
                                    <select id="snp3" onchange="calculatePRS()">
                                        <option value="0" selected>AA (0)</option>
                                        <option value="1">AG (1)</option>
                                        <option value="2">GG (2)</option>
                                    </select>
                                </td>
                                <td id="contrib3">0.00</td>
                            </tr>
                            <tr>
                                <td>rs44556</td>
                                <td>C</td>
                                <td>0.20</td>
                                <td>
                                    <select id="snp4" onchange="calculatePRS()">
                                        <option value="0">TT (0)</option>
                                        <option value="1" selected>CT (1)</option>
                                        <option value="2">CC (2)</option>
                                    </select>
                                </td>
                                <td id="contrib4">0.20</td>
                            </tr>
                            <tr>
                                <td>rs78901</td>
                                <td>A</td>
                                <td>0.05</td>
                                <td>
                                    <select id="snp5" onchange="calculatePRS()">
                                        <option value="0">GG (0)</option>
                                        <option value="1" selected>AG (1)</option>
                                        <option value="2">AA (2)</option>
                                    </select>
                                </td>
                                <td id="contrib5">0.05</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="result-box" style="margin-top: 1rem;">
                        <div class="label">Your Polygenic Risk Score</div>
                        <div class="score" id="totalPRS">0.56</div>
                        <div class="label" id="percentileLabel">~47th percentile (average genetic risk)</div>
                    </div>
                </div>

                <!-- Right: Distribution Chart -->
                <div>
                    <h3 style="margin-bottom: 0.5rem;">üìä Population Distribution</h3>
                    <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem;">
                        The red line shows where your PRS falls in the population.
                    </p>
                    <div style="height: 250px; position: relative;">
                        <canvas id="distributionChart"></canvas>
                    </div>

                    <div class="percentile-display" style="margin-top: 1rem;">
                        <div class="percentile-card low">
                            <div>Bottom 10%</div>
                            <div class="value">0.5-1x</div>
                            <div>risk</div>
                        </div>
                        <div class="percentile-card avg">
                            <div>Middle 80%</div>
                            <div class="value">1-2x</div>
                            <div>risk</div>
                        </div>
                        <div class="percentile-card high">
                            <div>Top 10%</div>
                            <div class="value">2-5x</div>
                            <div>risk</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Clinical Applications -->
        <div class="card">
            <h2>üè• PRS in Clinical Practice: CanRisk for Breast Cancer</h2>
            <p>
                The most clinically validated application of PRS is in <strong>breast cancer risk assessment</strong>.
                The <strong>CanRisk tool</strong> (implementing the BOADICEA model) is already used in clinical practice
                in the UK and internationally.
            </p>

            <div style="background: #fdf2f8; border: 1px solid #fbcfe8; border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0;">
                <h4 style="color: #be185d; margin: 0 0 1rem 0;">üéÄ CanRisk / BOADICEA</h4>
                <p style="margin-bottom: 1rem;">
                    <strong>CanRisk</strong> is a web-based tool used by healthcare professionals to calculate an individual's
                    risk of developing breast and ovarian cancer. It combines multiple risk factors:
                </p>
                <ul style="padding-left: 1.5rem; margin: 0.5rem 0;">
                    <li><strong>Polygenic Risk Score</strong> ‚Äî aggregating common genetic variants</li>
                    <li><strong>Rare pathogenic variants</strong> ‚Äî in genes like BRCA1, BRCA2, PALB2, CHEK2, ATM</li>
                    <li><strong>Family history</strong> ‚Äî detailed pedigree information</li>
                    <li><strong>Lifestyle factors</strong> ‚Äî BMI, alcohol, hormone use</li>
                    <li><strong>Clinical factors</strong> ‚Äî mammographic density, previous biopsies</li>
                </ul>

                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #fbcfe8;">
                    <strong>Clinical Use:</strong>
                    <ul style="padding-left: 1.5rem; margin: 0.5rem 0;">
                        <li>Recommended by NICE guidelines for familial breast cancer risk assessment</li>
                        <li>Incorporated into NCCN guidelines (US)</li>
                        <li>Used to determine eligibility for enhanced screening (e.g., MRI) or genetic testing</li>
                        <li>Estonia is implementing PRS-based risk-stratified breast cancer screening nationally (starting 2025)</li>
                    </ul>
                </div>

                <div style="margin-top: 1rem; font-size: 0.9rem; color: #6b7280;">
                    <strong>Note:</strong> CanRisk is the first freely accessible cancer risk prediction tool to carry CE marking
                    (European conformity certification for medical devices).
                </div>
            </div>

            <h3>Other Emerging Applications</h3>
            <p>
                PRS for <strong>coronary artery disease</strong> is also approaching clinical use. Individuals in the top 5%
                of genetic risk have approximately 3-fold increased risk ‚Äî similar to having familial hypercholesterolemia.
                These scores may help guide statin therapy decisions, particularly for patients at intermediate clinical risk.
            </p>
            <p style="margin-top: 1rem; color: #6b7280; font-size: 0.9rem;">
                However, most PRS applications are still in research or pilot phases. Breast cancer remains the most
                clinically validated use case with established guidelines and tools.
            </p>
        </div>
        
        <!-- Limitations -->
        <div class="card">
            <h2>‚ö†Ô∏è Limitations & Challenges</h2>
            
            <div class="limitation-item">
                <div class="limitation-icon">üåç</div>
                <div>
                    <strong>Ancestry Bias</strong>
                    <p>Most GWAS are from European populations. PRS performance drops significantly in non-European groups, risking health disparities.</p>
                </div>
            </div>
            
            <div class="limitation-item">
                <div class="limitation-icon">üìâ</div>
                <div>
                    <strong>Missing Heritability</strong>
                    <p>PRS typically explain only 5-20% of disease heritability. Environmental factors, rare variants, and gene interactions are not captured.</p>
                </div>
            </div>
            
            <div class="limitation-item">
                <div class="limitation-icon">‚ùì</div>
                <div>
                    <strong>Clinical Utility</strong>
                    <p>Does knowing your PRS change outcomes? How do we communicate probabilistic risk effectively to patients?</p>
                </div>
            </div>
            
            <div class="limitation-item">
                <div class="limitation-icon">‚öñÔ∏è</div>
                <div>
                    <strong>Ethical Considerations</strong>
                    <p>Privacy concerns, potential for genetic discrimination, psychological impact, and equitable access remain important issues.</p>
                </div>
            </div>
        </div>
        
        <!-- Summary -->
        <div class="card">
            <h2>üìù Key Takeaways</h2>
            <ol style="padding-left: 1.5rem; line-height: 2;">
                <li>PRS aggregate many small genetic effects into a single risk estimate</li>
                <li>GWAS provide the foundation by identifying variants and effect sizes</li>
                <li>The calculation is additive: PRS = Œ£(Œ≤ √ó genotype)</li>
                <li>Clinical applications are emerging in breast cancer, CAD, prostate cancer, and diabetes</li>
                <li>Important limitations exist: ancestry bias, incomplete risk capture, and clinical utility questions</li>
            </ol>
        </div>

        <!-- Further Reading -->
        <div class="card references">
            <h2>üìö Further Reading</h2>
            <ul>
                <li><strong>Torkamani A, et al. (2018)</strong>. The personal and clinical utility of polygenic risk scores. <em>Nature Reviews Genetics</em>. <a href="https://doi.org/10.1038/s41576-018-0018-x" target="_blank" style="color: var(--primary);">doi:10.1038/s41576-018-0018-x</a></li>
                <li><strong>Khera AV, et al. (2018)</strong>. Genome-wide polygenic scores for common diseases identify individuals with risk equivalent to monogenic mutations. <em>Nature Genetics</em>. <a href="https://doi.org/10.1038/s41588-018-0183-z" target="_blank" style="color: var(--primary);">doi:10.1038/s41588-018-0183-z</a></li>
                <li><strong>Lewis CM & Vassos E (2020)</strong>. Polygenic risk scores: from research tools to clinical instruments. <em>Genome Medicine</em>. <a href="https://doi.org/10.1186/s13073-020-00742-5" target="_blank" style="color: var(--primary);">doi:10.1186/s13073-020-00742-5</a></li>
            </ul>
        </div>

        <!-- STUDENT TASKS SECTION -->
        <div class="task-section">
            <h2>üìã Student Tasks</h2>
            <p>The following tasks accompany the lecture on GWAS and Polygenic Risk Scores.</p>

            <div class="learning-objectives">
                <h4>üéØ Learning Objectives</h4>
                <ul>
                    <li>Understand the difference between rare (monogenic) and common (polygenic) genetic variants</li>
                    <li>Explain how GWAS identifies disease-associated variants</li>
                    <li>Describe how PRS are calculated and interpreted</li>
                    <li>Recognize limitations and current clinical applications of PRS</li>
                </ul>
            </div>
        </div>

        <!-- Part A: Discussion Tasks -->
        <div class="card">
            <h2>üí¨ Part A: Classroom Discussion Tasks</h2>
            <p>These tasks are meant for group discussion or individual reflection. The goal is to think critically about the concepts.</p>

            <!-- Task A1 -->
            <div class="task-card">
                <h3>Task A1: Rare vs. Common Variants</h3>
                <p>In the first part of today's lecture, you learned about <strong>monogenic kidney diseases</strong> like Alport syndrome, where a single rare variant with a large effect causes disease.</p>
                <p>Now consider <strong>Type 2 Diabetes</strong> or <strong>Coronary Artery Disease</strong>, where hundreds of common variants each contribute a tiny amount of risk.</p>

                <div class="discussion-question">
                    <strong>a)</strong> Why do you think rare disease-causing variants (like in Alport syndrome) are rare in the population, while diabetes-associated variants are common?
                </div>
                <div class="discussion-question">
                    <strong>b)</strong> If a single variant increases diabetes risk by only 1.05-fold (5% increase), why doesn't natural selection remove it from the population?
                </div>
                <div class="discussion-question">
                    <strong>c)</strong> A patient asks: <em>"I have a family history of heart disease. Should I get genetic testing?"</em> ‚Äî How would your answer differ if you suspect a monogenic condition vs. a polygenic predisposition?
                </div>
            </div>

            <!-- Task A2 -->
            <div class="task-card">
                <h3>Task A2: Understanding GWAS</h3>
                <p>A research group wants to identify genetic variants associated with <strong>breast cancer</strong>. They collect DNA from 50,000 women with breast cancer (cases) and 50,000 women without breast cancer (controls).</p>

                <div class="discussion-question">
                    <strong>a)</strong> The researchers test 5 million SNPs across the genome. Why do they need such a large sample size (100,000 people)?
                </div>
                <div class="discussion-question">
                    <strong>b)</strong> After analysis, they find 300 SNPs significantly associated with breast cancer. Most of these SNPs are in non-coding regions of the genome (not in genes). Why might this be?
                </div>
                <div class="discussion-question">
                    <strong>c)</strong> One SNP (rs12345) shows an odds ratio of 1.08. What does this number mean in plain language?
                </div>
                <div class="discussion-question">
                    <strong>d)</strong> Why can't researchers simply use these 300 SNPs to predict exactly who will get breast cancer?
                </div>
            </div>

            <!-- Task A3 -->
            <div class="task-card">
                <h3>Task A3: Calculating a Simple PRS</h3>
                <p>Below is a simplified example with 5 SNPs associated with a hypothetical trait:</p>

                <table class="snp-table" style="margin: 1rem 0;">
                    <thead>
                        <tr>
                            <th>SNP</th>
                            <th>Risk Allele</th>
                            <th>Effect (Œ≤)</th>
                            <th>Person's Genotype</th>
                            <th>Risk Alleles Carried</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>rs001</td><td>A</td><td>0.10</td><td>AG</td><td>1</td></tr>
                        <tr><td>rs002</td><td>T</td><td>0.15</td><td>TT</td><td>2</td></tr>
                        <tr><td>rs003</td><td>C</td><td>0.05</td><td>GG</td><td>0</td></tr>
                        <tr><td>rs004</td><td>G</td><td>0.20</td><td>AG</td><td>1</td></tr>
                        <tr><td>rs005</td><td>A</td><td>0.08</td><td>AA</td><td>2</td></tr>
                    </tbody>
                </table>

                <div class="discussion-question">
                    <strong>a)</strong> Calculate this person's PRS using the formula: <strong>PRS = Œ£ (Œ≤ √ó number of risk alleles)</strong>
                </div>
                <div class="discussion-question">
                    <strong>b)</strong> The population average PRS for this trait is 0.45, with a standard deviation of 0.15. Is this person above or below average risk? Approximately what percentile might they fall into?
                </div>
                <div class="discussion-question">
                    <strong>c)</strong> If you added 295 more SNPs to this score (making it 300 SNPs total), would you expect the score to become more or less predictive of disease? Why?
                </div>
            </div>

            <!-- Task A4 -->
            <div class="task-card">
                <h3>Task A4: Limitations and Equity</h3>
                <p>The <strong>BOADICEA</strong> model is a breast cancer risk prediction tool used in UK clinical practice. It incorporates a PRS derived primarily from studies in European populations.</p>

                <div class="discussion-question">
                    <strong>a)</strong> A woman of West African ancestry receives a PRS result from BOADICEA. Why might her result be less accurate than for a woman of European ancestry?
                </div>
                <div class="discussion-question">
                    <strong>b)</strong> What are the potential consequences of using European-derived PRS in diverse populations? Think about both individual patients and public health.
                </div>
                <div class="discussion-question">
                    <strong>c)</strong> How might researchers address this limitation in the future?
                </div>
                <div class="discussion-question">
                    <strong>d)</strong> Beyond ancestry, what other factors influence breast cancer risk that are NOT captured by a PRS?
                </div>
            </div>
        </div>

    </div>

    <footer>
        Molecular Medicine Course | Polygenic Risk Scores Module
    </footer>
    
    <script>
        // Effect sizes for the 5 demo SNPs
        const effects = [0.15, 0.08, 0.12, 0.20, 0.05];

        // Distribution chart
        let distributionChart;
        let markerZScore = 0;
        let markerPercentile = 50;

        function calculatePRS() {
            let total = 0;
            for (let i = 1; i <= 5; i++) {
                const alleles = parseInt(document.getElementById(`snp${i}`).value);
                const contribution = alleles * effects[i-1];
                document.getElementById(`contrib${i}`).textContent = contribution.toFixed(2);
                total += contribution;
            }
            document.getElementById('totalPRS').textContent = total.toFixed(2);

            // Calculate z-score based on normal distribution
            // Mean PRS = sum of (effect * 1) for each SNP (assuming 1 allele on average)
            const maxPossible = effects.reduce((a,b) => a + b*2, 0); // 1.20
            const mean = maxPossible / 2; // 0.60
            const sd = maxPossible / 6;   // ~0.20 (so ¬±3 SD covers the range)

            // Convert raw score to z-score
            markerZScore = (total - mean) / sd;
            // Clamp to [-3, 3] range
            markerZScore = Math.max(-3, Math.min(3, markerZScore));

            // Convert z-score to percentile using normal CDF approximation
            const percentile = Math.round(normalCDF(markerZScore) * 100);
            markerPercentile = percentile;

            let riskLabel = '';
            if (percentile < 25) riskLabel = 'lower genetic risk';
            else if (percentile < 75) riskLabel = 'average genetic risk';
            else riskLabel = 'higher genetic risk';

            document.getElementById('percentileLabel').textContent =
                `~${percentile}th percentile (${riskLabel})`;

            // Update the distribution chart marker
            if (distributionChart) {
                distributionChart.update();
            }
        }

        // Normal CDF approximation
        function normalCDF(z) {
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;

            const sign = z < 0 ? -1 : 1;
            z = Math.abs(z) / Math.sqrt(2);

            const t = 1.0 / (1.0 + p * z);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-z * z);

            return 0.5 * (1.0 + sign * y);
        }

        function initDistributionChart() {
            const canvas = document.getElementById('distributionChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            // Generate normal distribution data
            const labels = [];
            const data = [];
            for (let x = -3; x <= 3; x += 0.1) {
                labels.push(x.toFixed(1));
                data.push(Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI));
            }

            distributionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Population Distribution',
                        data: data,
                        fill: true,
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'PRS (z-score)' },
                            ticks: {
                                callback: function(val, index) {
                                    return index % 10 === 0 ? this.getLabelForValue(val) : '';
                                }
                            }
                        },
                        y: {
                            title: { display: true, text: 'Frequency' },
                            beginAtZero: true
                        }
                    },
                    animation: false
                },
                plugins: [{
                    id: 'verticalLine',
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        const xAxis = chart.scales.x;
                        const yAxis = chart.scales.y;

                        // Use z-score directly to find position
                        // z-score ranges from -3 to 3, data indices from 0 to 60
                        const dataIndex = Math.round((markerZScore + 3) / 0.1);
                        const xPos = xAxis.getPixelForValue(dataIndex);

                        // Draw vertical line
                        ctx.save();
                        ctx.beginPath();
                        ctx.moveTo(xPos, yAxis.top + 25);
                        ctx.lineTo(xPos, yAxis.bottom);
                        ctx.lineWidth = 3;
                        ctx.strokeStyle = '#dc2626';
                        ctx.stroke();

                        // Draw label background
                        const labelText = `${markerPercentile}th %ile`;
                        ctx.font = 'bold 12px IBM Plex Sans, sans-serif';
                        const textWidth = ctx.measureText(labelText).width;
                        ctx.fillStyle = '#dc2626';
                        ctx.fillRect(xPos - textWidth/2 - 6, yAxis.top + 2, textWidth + 12, 20);

                        // Draw label text
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(labelText, xPos, yAxis.top + 12);
                        ctx.restore();
                    }
                }]
            });
        }

        // Initialize on load
        window.onload = function() {
            initDistributionChart();
            calculatePRS();
        };
    </script>
</body>
</html>
